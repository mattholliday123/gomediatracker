<!doctype html>
<html>
  <head>
    <title>My Games</title>
    <style>
      body {
        background-color: Canvas;
        color: CanvasText;
        color-scheme: light dark;
      }
    </style>
  </head>
  <body>
    <h1>Games Collected</h1>
    <ul id="collected"></ul>
    <script type="module">
      const colDisplay = document.getElementById("collected");
      try {
        const response = await fetch("/getGames");
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const games = await response.json();
        games.forEach((game) => {
          const dev =
            game.involved_companies?.find((ic) => ic.developer)?.company
              ?.name || "Unkown developer";
          const releaseDate =
            game.release_dates && game.release_dates.length > 0
              ? game.release_dates.sort((a, b) => a.date - b.date)[0]?.human ||
                "TBA"
              : "TBA";
          const gameStored = {
            id: game.id,
            name: game.name,
            summary: game.summary,
            releaseDate: releaseDate,
            developer: dev,
          };
          sessionStorage.setItem(`game_${game.id}`, JSON.stringify(gameStored));

          const a = document.createElement("a");
          const li = document.createElement("li");
          a.innerText =
            game.title +
            "|Release Date: " +
            game.year +
            "| Developer: " +
            game.studio +
            "| Status: " +
            game.status;
          a.href = `/game_page.html?id=${encodeURIComponent(game.id)}`;
          li.appendChild(a);
          colDisplay.appendChild(li);
          console.log(
            game.title +
              "| Developer: " +
              game.studio +
              "| Status: " +
              game.status,
          );
        });
      } catch (error) {
        console.error("Failed to fetch games:", error);
      }
    </script>
  </body>
</html>

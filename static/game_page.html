<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="title">Game Details - Media Collection</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <nav class="nav-bar">
      <div class="container">
        <a href="home.html" class="nav-brand">
          <strong>Media Collection</strong>
        </a>
        <ul class="nav-links">
          <li><a href="all.html">All Media</a></li>
          <li><a href="books.html">Books</a></li>
          <li><a href="movies.html">Movies</a></li>
          <li><a href="music.html">Music</a></li>
          <li><a href="video_games.html" class="active">Video Games</a></li>
        </ul>
      </div>
    </nav>

    <main class="container" style="max-width: 800px; margin-top: var(--spacing-2xl);">
      <div id="error-message" class="card" style="display: none; border-color: var(--error);">
        <div style="color: var(--error);">
          <strong>Error:</strong> Game information not found. Please go back and search again.
        </div>
        <a href="video_games.html" class="btn btn-primary mt-md">Back to Search</a>
      </div>

      <div id="game-content" style="display: none;">
        <div class="card mb-xl">
          <h1 id="headingname" class="card-title"></h1>
          
          <div class="card-meta mb-lg">
            <span class="card-meta-item">
              <span></span>
              <span id="release-date"></span>
            </span>
            <span class="card-meta-item">
              <span></span>
              <span id="developer"></span>
            </span>
          </div>

          <div class="form-group">
            <label for="summary">Description</label>
            <p id="summary" class="card-description" style="margin-top: 0;"></p>
          </div>

          <div class="form-group">
            <label for="status">Status</label>
            <select name="status" id="status">
              <option value="unplayed">Unplayed</option>
              <option value="played">Played</option>
            </select>
          </div>

          <button type="button" id="save-button" class="btn btn-primary">
            Save to Collection
          </button>

          <div id="success-message" style="display: none; margin-top: var(--spacing-md); padding: var(--spacing-md); background-color: rgba(0, 224, 84, 0.15); border-radius: var(--radius-md); color: var(--success);">
            Game saved successfully!
          </div>
        </div>

        <div style="text-align: center;">
          <a href="game_collection.html" class="btn btn-secondary">View Collection</a>
          <a href="video_games.html" class="btn btn-secondary">Back to Search</a>
        </div>
      </div>
    </main>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const gameId = urlParams.get("id");
      const gameData = sessionStorage.getItem(`game_${gameId}`);
      
      const errorMessage = document.getElementById("error-message");
      const gameContent = document.getElementById("game-content");
      const title = document.getElementById("title");
      const heading = document.getElementById("headingname");
      const summary = document.getElementById("summary");
      const releaseDate = document.getElementById("release-date");
      const developer = document.getElementById("developer");
      const saveButton = document.getElementById("save-button");
      const statusSelect = document.getElementById("status");
      const successMessage = document.getElementById("success-message");

      if (!gameData) {
        errorMessage.style.display = "block";
      } else {
        const game = JSON.parse(gameData);
        
        title.innerText = `${game.name} - Media Collection`;
        heading.innerText = game.name;
        summary.textContent = game.summary || "No description available";
        releaseDate.textContent = game.releaseDate || "Unknown";
        developer.textContent = game.developer || "Unknown";
        
        gameContent.style.display = "block";

        saveButton.addEventListener("click", async () => {
          saveButton.disabled = true;
          saveButton.textContent = "Saving...";
          
          try {
            const response = await fetch(
              `/savegame?gameId=${encodeURIComponent(game.id)}&name=${encodeURIComponent(game.name)}&date=${encodeURIComponent(game.releaseDate)}&dev=${encodeURIComponent(game.developer)}&status=${encodeURIComponent(statusSelect.value)}`,
            );
            
            if (response.ok) {
              successMessage.style.display = "block";
              setTimeout(() => {
                successMessage.style.display = "none";
              }, 3000);
            }
          } catch (error) {
            console.error("Error saving game:", error);
            alert("Failed to save game. Please try again.");
          } finally {
            saveButton.disabled = false;
            saveButton.textContent = "Save to Collection";
          }
        });
      }
    </script>
  </body>
</html>
